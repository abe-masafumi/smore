<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>smore</title>
  <link rel="stylesheet" href="../styles/common.css">
  <link rel="stylesheet" href="../styles/styles.css">
</head>

<body>
  <!-- オーバーレイ -->
  <div class="overlay"></div>


  <!-- モーダルウィンドウ -->
  <div class="modal">
    <div class="close">&times</div>

  </div>
  <!-- js読み込み時のroading画面 -->
  <div id="loading" class="center" style="height: 600px;">loading...</div>
  <!-- ログインしてないけどページを開いちゃった時の画面 -->
  <div class="center none" id="prompt" style="height: 600px;">
    <div class="center">
      <h1>ログインしてください</h1>
      <img width="100%" src="../images/Smore_illust_12.png" alt="">
      <p>ログインは<span id="login" onclick="location.href=['./login_form.html']">こちら</span></p>
    </div>
  </div>
  <!-- ----end---- -->
  <!-- 通常時の画面 -->
  <div id="big_container" class="none">
    <header class="page-header row">
      <div class="col-4 center">
        <button onclick="location.href=['./飼い主my_page.html']">戻る</button>
      </div>
      <h1 class="col-4 center">詳細</h1>
      <div class="col-4 center">
      </div>
    </header>
    <main>
      <div>
        <!-- ----------pet_info-------------- -->
        <ul style="width: 100%;">
          <li style="width: 250px; height: auto; object-fit: cover;">
            <img style="width: 100%; height: auto;" src="" alt="" id="p_img">
            <button data-name="edit_img01" data-type="text" class="edit_btn">編集ボタン</button>
          </li>
          <li>
            <h1>名前<button data-name="edit_name" data-type="text" class="edit_btn">編集ボタン</button></h1>
            <p id="name"></p>
          </li>
          <li>
            <h1>生年月日<button data-name="edit_birthday" class="edit_btn">編集ボタン</button></h1>
            <p id="birthday"></p>
          </li>
          <li>
            <h1>性別 (男の子・女の子)<button data-name="edit_sex" class="edit_btn">編集ボタン</button></h1>
            <p id="sex"></p>
          </li>
          <li>
            <h1>犬種<button data-name="edit_type" class="edit_btn">編集ボタン</button></h1>
            <p id="犬種"></p>
          </li>
          <li>
            <h1>去勢・避妊（未・済）<button data-name="edit_k" class="edit_btn">編集ボタン</button></h1>
            <p id="去勢"></p>
          </li>
          <li>
            <h1>体重<button data-name="edit_weight" class="edit_btn">編集ボタン</button></h1>
            <p id="weight"></p>
          </li>
          <li>
            <h1>毛色<button data-name="edit_color" class="edit_btn">編集ボタン</button></h1>
            <p id="color"></p>
          </li>
          <li>
            <h1>耳（たれ耳・立ち耳<button data-name="edit_ear" class="edit_btn">編集ボタン</button></h1>
            <p id="era"></p>
          </li>
          <li>
            <h1>犬の登録をし、鑑札を受け取っていますか？<button data-name="edit_Q1" class="edit_btn">編集ボタン</button></h1>
            <p id="登録"></p>
          </li>
          <li>
            <h1>狂犬病予防注射を受け、注射済み票を受け取っていますか？<button data-name="edit_Q2" class="edit_btn">編集ボタン</button></h1>
            <p id="注射"></p>
          </li>
          <li>
            <h1>ごはん(品名・量)<button data-name="edit_meal" class="edit_btn">編集ボタン</button></h1>
            <p id="meal"></p>
          </li>
          <li>
            <h1>かかりつけの病院<button data-name="edit_doctor" class="edit_btn">編集ボタン</button></h1>
            <p id="doctor"></p>
          </li>
          <li>
            <h1>病歴・アレルギー<button data-name="edit_allergy" class="edit_btn">編集ボタン</button></h1>
            <p id="allergy"></p>
          </li>
          <li>
            <h1>お薬<button data-name="edit_medicine" class="edit_btn">編集ボタン</button></h1>
            <p id="medicine"></p>
          </li>
          <li>
            <h1>サロン<button data-name="edit_salon" class="edit_btn">編集ボタン</button></h1>
            <p id="salon"></p>
          </li>
          <li>
            <h1>マイクロチップ番号<button data-name="edit_microchip" class="edit_btn">編集ボタン</button></h1>
            <p id="microchip_number"></p>
          </li>
          <li>
            <h1>写真１：狂犬病予防注射済み票<button data-name="edit_img02" class="edit_btn">編集ボタン</button></h1>
            <div style="width: 250px; height: auto; object-fit: cover;"><img style="width: 100%;" src="" alt=""
                id="狂犬病予防注射済み票"></div>
          </li>
          <li>
            <h1>写真２：混合ワクチン接種証明書<button data-name="edit_img03" class="edit_btn">編集ボタン</button></h1>
            <div style="width: 250px; height: auto; object-fit: cover;">
              <img style="width: 100%;" src="" alt="" id="混合ワクチン接種証明書">
          </li>
      </div>
      </ul>
      <!-- ----------pet_info-------------- -->

      <div class="space_32"></div>
      <div class="center">
      </div>
    </main>
    <!-- footerは使ってない -->
    <footer class="page-footer"></footer>

  </div>
  <!-- ----end---- -->

  <script type="module">
    import { connect_firebase } from "../firebaseConfig.js"
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
    import { getFirestore, collection, getDoc, doc, onSnapshot, updateDoc } from " https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";
    import { getStorage, ref, getDownloadURL, uploadBytes, uploadBytesResumable } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-storage.js";

    // firebaseと接続
    const app = connect_firebase();
    const auth = getAuth(app);
    const db = getFirestore(app);
    const storage = getStorage(app);

    const loading = document.getElementById('loading');
    const big_container = document.getElementById('big_container');

    // ボタン、モダル、モダルの閉じるボタン、オーバーレイを変数に格納
    const modal = document.querySelector('.modal');
    const closeBtn = document.querySelector('.close');
    const overlay = document.querySelector('.overlay');

    const p_img = document.getElementById('p_img');
    const name = document.getElementById('name');
    const 犬種 = document.getElementById('犬種');
    const 登録 = document.getElementById('登録');
    const 注射 = document.getElementById('注射');
    const birthday = document.getElementById('birthday');
    const sex = document.getElementById('sex');
    const 去勢 = document.getElementById('去勢');
    const weight = document.getElementById('weight');
    const color = document.getElementById('color');
    const era = document.getElementById('era');
    const meal = document.getElementById('meal');
    const doctor = document.getElementById('doctor');
    const allergy = document.getElementById('allergy');
    const medicine = document.getElementById('medicine');
    const salon = document.getElementById('salon');
    const microchip_number = document.getElementById('microchip_number');
    const 狂犬病予防注射済み票 = document.getElementById('狂犬病予防注射済み票');
    const 混合ワクチン接種証明書 = document.getElementById('混合ワクチン接種証明書');
    /**
     * selectのoptionタグを生成するための関数
     * @param {Element} elem 変更したいselectの要素
     * @param {Number} val 表示される文字と値の数値
     */
    function createOptionForElements(elem, val) {
      let option = document.createElement('option');
      option.text = val;
      option.value = val;
      elem.appendChild(option);
    }

    let petID;
    let user_id;
    let data;

    function get_url_data(user_id) {
      let params = (new URL(document.location)).searchParams;
      petID = params.get('petID');
      console.log("petID", petID);

      const docRef = doc(db, 'users', user_id, "pets", petID);
      loading.classList.add('none');
      big_container.classList.remove('none');
      const unsub = onSnapshot(docRef, (doc) => {
        data = doc.data();
        console.log(data["写真"]);
        p_img.src = data["写真"];
        name.textContent = data["名前"];
        犬種.textContent = data["犬種"];
        登録.textContent = data["犬の登録をし鑑札を受け取っていますか"];
        注射.textContent = data["狂犬病予防注射を受け注射済み票を受け取っていますか"];
        birthday.textContent = data["生年月日"];
        sex.textContent = data["性別"];
        去勢.textContent = data["去勢避妊"];
        weight.textContent = data["体重"];
        color.textContent = data["毛色"];
        era.textContent = data["耳"];
        meal.textContent = data["ごはん"];
        doctor.textContent = data["かかりつけの病院"];
        allergy.textContent = data["病歴アレルギー"];
        medicine.textContent = data["お薬"];
        salon.textContent = data["サロン"];
        microchip_number.textContent = data["マイクロチップ番号"];
        狂犬病予防注射済み票.src = data["狂犬病予防注射済み票"];
        混合ワクチン接種証明書.src = data["混合ワクチン接種証明書"];
      });
    }

    // ログイン状態の確認 この関数はログイン状態が変わるたびに呼び出される
    onAuthStateChanged(auth, (user) => {
      if (user) {
        user_id = user.uid;
        const u_email = user.email;
        console.log(user_id, "状態:ログイン中");
        return get_url_data(user_id)
      } else {
        // User is signed out
        console.log("状態:ログアウト");
        make_sign_out_display();
      }
    });

    const edit_btn = document.getElementsByClassName('edit_btn');
    let child;
    let edit_name;
    let myform
    let pet_img_url;
    let pet_img_file;



    console.log(edit_btn[0].value);
    for (let i = 0; i < edit_btn.length; i++) {
      edit_btn[i].addEventListener('click', function (e) {

        const tag_name = e.currentTarget.dataset['name'];

        switch (tag_name) {
          case "edit_name":
            edit_name = "名前"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                        <div class="space_32"></div>
                        <p>ペットの名前<span class="sub">必須</span></p>
                        <input type="text" placeholder=" ぽち" id="edit_value" required style="font-size: 16px;">
                        <div class="space_32"></div>   
                        <input type="submit" value="登録" id="post_button"> 
                        </form>`;
            modal.appendChild(child);
            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();
              const edit_value = document.getElementById('edit_value');
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: edit_value.value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;

          case "edit_weight":
            edit_name = "体重"
            child = document.createElement('div');
            child.innerHTML = `  
            <form id="myform" class="m_auto">
              <p>体重<span class="sub">必須</span></p>
                        <div class="weight">
                            <select class="weight01" id="weight01" required>
                            </select>
                            .
                            <select class="weight02" id="weight02" required>
                            </select>
                            kg
                        </div>
                        <div class="space_32"></div>   

                        <input type="submit" value="登録" id="post_button"> 

                        </form>`;
            modal.appendChild(child);

            let weight01 = document.querySelector('.weight01');
            let weight02 = document.querySelector('.weight02');

            //年の生成
            for (let i = 1; i <= 30; i++) {
              createOptionForElements(weight01, i);
            }
            //月の生成
            for (let i = 0; i <= 9; i++) {
              createOptionForElements(weight02, i);
            }
            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();
              console.log(weight01.value);
              console.log(weight02.value);
              const edit_value = `${weight01.value}.${weight02.value}`
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: edit_value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;
          case "edit_birthday":
            edit_name = "生年月日"
            child = document.createElement('div');
            child.innerHTML = `  
            <form id="myform" class="m_auto">
              <p>生年月日<span class="sub">必須</span></p>
                        <div class="form-select-wrap">
                            <select class="birthday-year" id="select_year" required>
                            </select>
                            /
                            <select class="birthday-month" id="select_month" required>
                            </select>
                            /
                            <select class="birthday-day" id="select_day" required>
                            </select>
                            </div>
                        <div class="space_32"></div>   

                        <input type="submit" value="登録" id="post_button"> 

                        </form>`;
            modal.appendChild(child);

            let birthday_year = document.querySelector('.birthday-year');
            let birthday_month = document.querySelector('.birthday-month');
            let birthday_day = document.querySelector('.birthday-day');

            //年の生成
            for (let i = 1995; i <= 2022; i++) {
              createOptionForElements(birthday_year, i);
            }
            //月の生成
            for (let i = 1; i <= 12; i++) {
              createOptionForElements(birthday_month, i);
            }
            //日の生成
            for (let i = 1; i <= 31; i++) {
              createOptionForElements(birthday_day, i);
            }

            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();
              console.log(birthday_year.value);
              console.log(birthday_month.value);
              console.log(birthday_day.value);
              const edit_value = `${birthday_year.value}年${birthday_month.value}月${birthday_day.value}日`
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: edit_value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;

            case "edit_type":
            edit_name = "犬種"
            child = document.createElement('div');
            child.innerHTML = `  
            <form id="myform" class="m_auto">
               <p>犬種 (分からない場合はミックスと記入してください)<span class="sub">必須</span></p>
                        <div class="type01">
                            <select name="genre" id="genre">
                                <option disabled selected>五十音順で選択</option>
                                <option value="ミックス犬">ミックス犬</option>
                                <option value="あ行">あ行</option>
                                <option value="か行">か行</option>
                                <option value="さ行">さ行</option>
                                <option value="た行">た行</option>
                                <option value="な行">な行</option>
                                <option value="は行">は行</option>
                                <option value="ま行">ま行</option>
                                <option value="や行">や行</option>
                                <option value="ら行">ら行</option>
                                <option value="わ行">わ行</option>
                                <option value="その他">その他</option>
                              </select>
                        </div>
                        </br>
                          <div class="type02">
                              <select name="food-name" id="food-name" disabled>
                                <option selected>犬種を選択</option>
                              </select>
                          </div>
                          <div class="space_32"></div>   

                        <input type="submit" value="登録" id="post_button"> 

                        </form>`;
            modal.appendChild(child);

            //料理ジャンルの値と、それに対応するメニュー一覧を格納しておく -- [1]
            const foodMenu =
            {
              "ミックス犬": ["ミックス犬 5kg未満", "ミックス犬 10kg未満", "ミックス犬 25kg未満", "ミックス犬 25kg以上"],
              "あ行": ["アーフェンピンシャー", "アイリッシュウォータースパニエル", "アイリッシュウルフハウンド", "アイリッシュセッター", "アイリッシュテリア", "秋田犬", "アイリッシュレッドアンドホワイトセター", "小豆柴", "アナトリアンシェパード", "アフガンハウンド", "アメリカンアキタ", "アメリカンウォータースパニエル", "アメリカンエスキモードッグ", "アメリカンコッカースパニエル", "アメリカンスタッフォードシャーテリア", "アラスカンマラミュート",
                "イタリアングレーハウンド", "イビザンハウンド", "イングリッシュコッカースパニエル", "イングリッシュスプリンガースパニエル", "イングリッシュセッター", "イングリッシュポインター", "イングリッシュマスティフ",
                "ウィペット", "ウエストハイランドホワイトテリア", "ウェルシュシープドッグ", "ウェルシュスプリンガースパニエル", "ウェルシュテリア",
                "エアデールテリア", "エストレラマウンテンドッグ",
                "オーストラリアンキャトルドッグ", "オーストラリアンケルピー", "オーストラリアンシェパード", "オーストラリアンシルキーテリア", "オーストラリアンテリア", "オールドイングリッシュシープドッグ"],
              "か行": ["甲斐犬", "カーリーコーテッドレトリバー", "カニンヘンダックスフンド", "カレリアンベアドッグ",
                "キースホンド", "紀州犬", "キャバチワ", "キャバプー", "キャバリア", "キングチャールズスパニエル"
                , "クーバース", "クランバースパニエル", "グレイハウンド", "グレートデン", "グレートピレニーズ", "クロアチアンシープドッグ", "クロムフォルレンダー"
                , "ケアンテリア", "ケリーブルーテリア"
                , "コーイケルホンディエ", "コーギー(ウェルシュコーギーカーディガン)", "コーギー(ウェルシュコーギーペンブローク)", "ゴードンセッター", "ゴールデンドゥードル", "ゴールデンレトリバー", "コッカークス", "コッカプー", "コトン・ド・テュレアール", "コモンドール"],
              "さ行": ["サーロスウルフドッグ", "サモエド", "サルーキ"
                , "シーズー", "シープー", "シーポメ", "シーリハムテリア", "シェットランドシープドッグ", "シェパード種", "柴犬", "シベリアンハスキー", "シャーペイ", "ジャーマンシェパード", "ジャーマンショートヘアードポインター", "ジャーマンスパニエル", "ジャーマンハンティングテリア", "ジャーマンピンシャー", "ジャーマンワイアーヘアードポインター", "ジャイアントシュナウザー", "ジャックラッセルテリア", "シュナウザー種", "シュナプー", "シュナマル", "シーリハムテリア"
                , "スカイテリア", "スキッパーキ", "スコティッシュテリア", "スタッフォードシャーブルテリア", "スタンダードダックスフンド", "スタンダードプードル", "スパニッシュマスティフ"
                , "セントバーナード"
                , "ソフトコーテッド・ウィートンテリア"],
              "た行": ["タイニープードル", "ダップー", "ダルメシアン"
                , "チベタンスパニエル", "チベタンテリア", "チベタンマスティフ", "チャイニーズクレステッドドッグ", "チャウチャウ", "チワズー", "チワックス", "チワパグ", "チワピン", "チワプー", "チワブル", "チワマル", "チワワ"
                , "狆", "ティーカッププードル"
                , "トイプードル", "トイマンチェスターテリア", "ドーベルマン", "ドゴアルヘンティーノ", "土佐犬.四国犬", "土佐闘犬"],
              "な行": ["ナポリタンマスティフ"
                , "日本スピッツ", "日本テリア", "ニューファンドランド"
                , "ノーフォークテリア", "ノーリッチテリア"],
              "は行": ["ハバニーズ", "バーニーズマウンテンドッグ", "パグ", "パグズー", "バセットハウンド", "バセンジー", "パピキー", "パピチワ", "パピヨン", "ハリア", "パーソンラッセルテリア"
                , "ビアデッドコリー", "ビーグル", "ビションフリーゼ", "ピットブル", "ピンプー"
                , "ファラオハウンド", "プーリー", "プチバセットグリフォンバンデーン", "プチブラバンソン", "フラットコーテッドレトリバー", "ブラッドハウンド", "ブリタニースパニエル", "ブリュッセルグリフォン", "ブルドッグ", "ブルマスティフ", "フレンチブルドッグ"
                , "ペキチー", "ペキックス", "ペキニーズ", "ペキプー", "ベドリントンテリア", "ベルジアングリフォン", "ベルジアングローネンダール", "ベルジアンタービュレン", "ベルジアンマリノア"
                , "ボーダーコリー", "ボーダーテリア", "ポーチュギーズウォータードッグ", "ボクサー犬", "ボストンテリア", "北海道犬", "ポメキー", "ポメ柴", "ポメチワ", "ポメックス", "ポメパグ", "ポメプー", "ポメマル", "ポメヨン", "ポメラニアン", "ポリッシュローランドシープドッグ", "ボルゾイ", "ボルドーマスティフ", "ボロニーズ", "ホワイトシェパード", "ポンスキー"],
              "ま行": ["豆柴", "マルーキー", "マルシーズ", "マルチーズ", "マルックス", "マルパピ", "マルプー"
                , "ミニチュアシベリアンハスキー", "ミニチュアシュナウザー", "ミニチュアダックスフンド", "ミニチュアピンシャー", "ミニチュアプードル", "ミニチュアブルテリア"],
              "や行": ["ヨークシャテリア"
                , "ヨーチー", "ヨープー"],
              "ら行": ["ラサアプソ"
                , "ラフコリー", "ラブラドールレトリバー", "ラブラドゥードル"
                , "レークランドテリア", "レオンベルガー"
                , "ロットワイラー"],
              "わ行": ["ワイマラナー"
                , "ワイヤーフォックステリア"],
              "その他": ["その他"]
            };

            //選択されたジャンルを受け取って処理をする -- [4]

            let option;

            const selectFoodName = document.getElementById('food-name'); //2つめのセレクトボックスを取得し
            function setMenuOptions(selectedGenre) {
              selectFoodName.innerHTML = '';
              selectFoodName.disabled = false; //選択可能な状態にする

              //選択されたジャンルのメニュー一覧に対して処理をする
              foodMenu[selectedGenre].forEach((menu) => {
                option = document.createElement('option'); //option要素を新しく作る
                option.value = menu; //option要素の値に、メニューを識別できる番号を指定する
                option.innerHTML = menu; //ユーザー向けの表示としてメニュー名を指定する
                selectFoodName.appendChild(option); //セレクトボックスにoption要素を追加する
              });
            }

            //ジャンルを選ぶためのセレクトボックスを指定 -- [2]
            const genreSelect = document.getElementById('genre');

            //なんらかのジャンルが選択されたら（change）、処理を行う -- [3]
            genreSelect.addEventListener('change', (e) => {

              setMenuOptions(e.target.value);  //選択された料理ジャンルを引数として関数に渡す
              //※e.target.valueはgenreSelectで選択された値
            })

            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();
              console.log(genreSelect.value);
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: selectFoodName.value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;

          case "edit_k":
            edit_name = "去勢避妊"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                          <p>去勢・避妊<span class="sub">必須</span><br>
                            <label><input type="radio" name="去勢" value="未" required> 未</label>
                            <label><input type="radio" name="去勢" value="済"> 済</label>
                        </p>
                        <div class="space_32"></div>   
                        <input type="submit" value="登録" id="post_button"> 
                        </form>`;
            modal.appendChild(child);
            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();

              const edit_value = myform.去勢.value;
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: edit_value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;
          case "edit_sex":
            edit_name = "性別"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                          <p>性別<span class="sub">必須</span><br>
                            <lavel><input type="radio" name="sex" value="男の子"> 男の子</lavel>
                            <lavel><input type="radio" name="sex" value="女の子" required> 女の子</lavel>
                        </p>
                        <div class="space_32"></div>   
                        <input type="submit" value="登録" id="post_button"> 
                        </form>`;
            modal.appendChild(child);
            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();

              const edit_value = myform.sex.value;
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: edit_value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;

          // case "edit_type":
          //   edit_name = "犬種"
          //   child = document.createElement('div');
          //   child.innerHTML = `             
          //               <form id="myform" class="m_auto">
          //                 <p>犬種 (分からない場合はミックスと記入してください)<span class="sub">必須</span></p>
          //               <input type="text" id="edit_value" placeholder=" トイプードル" required style="font-size: 16px;">
          //               <div class="space_32"></div>   
          //               <input type="submit" value="登録" id="post_button"> 
          //               </form>`;
          //   modal.appendChild(child);
          //   myform = document.getElementById('myform');
          //   myform.addEventListener('submit', async (e) => {
          //     e.preventDefault();
          //     const edit_value = document.getElementById('edit_value');
          //     const washingtonRef = doc(db, "users", user_id, "pets", petID);
          //     await updateDoc(washingtonRef, {
          //       [edit_name]: edit_value.value
          //     });
          //     modal.classList.remove('active');
          //     overlay.classList.remove('active');
          //     child.remove();
          //   });
          //   break;

          case "edit_color":
            edit_name = "毛色"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                          <p>毛色<span class="sub">必須</span></p>
                        <input type="text" id="edit_value" placeholder=" ブラウン" required style="font-size: 16px;">
                        <div class="space_32"></div>   
                        <input type="submit" value="登録" id="post_button"> 
                        </form>`;
            modal.appendChild(child);
            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();
              const edit_value = document.getElementById('edit_value');
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: edit_value.value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;

          case "edit_ear":
            edit_name = "耳"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                          <p>耳<span class="sub">必須</span><br>
                            <label><input type="radio" name="耳" value="たれ耳" required> たれ耳</label>
                            <label><input type="radio" name="耳" value="立ち耳"> 立ち耳</label>
                        </p>
                        <div class="space_32"></div>   
                        <input type="submit" value="登録" id="post_button"> 
                        </form>`;
            modal.appendChild(child);
            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();

              const edit_value = myform.耳.value;
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: edit_value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;

          case "edit_meal":
            edit_name = "ごはん"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                          <p>ごはん(品名・一日の給餌量)</p>
                        <label ><input type="text" id="edit_value" placeholder=" ミシュワン,200" style="font-size: 16px;"> g</label>
                        <div class="space_32"></div>   
                        <input type="submit" value="登録" id="post_button"> 
                        </form>`;
            modal.appendChild(child);
            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();
              const edit_value = document.getElementById('edit_value');
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: edit_value.value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;

          case "edit_doctor":
            edit_name = "かかりつけの病院"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                          <p>かかりつけの病院</p>
                        <input type="text" id="edit_value" placeholder=" 病院名" style="font-size: 16px;">
                        <div class="space_32"></div>   
                        <input type="submit" value="登録" id="post_button"> 
                        </form>`;
            modal.appendChild(child);
            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();
              const edit_value = document.getElementById('edit_value');
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: edit_value.value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;
          case "edit_allergy":
            edit_name = "病歴アレルギー"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                          <p>病歴・アレルギー</p>
                        <input type="text" id="edit_value" placeholder=" 皮膚炎,チキンアレルギー" style="font-size: 16px;">
                        <div class="space_32"></div>   
                        <input type="submit" value="登録" id="post_button"> 
                        </form>`;
            modal.appendChild(child);
            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();
              const edit_value = document.getElementById('edit_value');
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: edit_value.value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;
          case "edit_medicine":
            edit_name = "お薬"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                          <p>お薬 (現在服用中のお薬)</p>
                        <input type="text" id="edit_value" placeholder=" マイフリーガード" style="font-size: 16px;">
                        <div class="space_32"></div>   
                        <input type="submit" value="登録" id="post_button"> 
                        </form>`;
            modal.appendChild(child);
            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();
              const edit_value = document.getElementById('edit_value');
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: edit_value.value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;
          case "edit_salon":
            edit_name = "サロン"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                          <p>サロン</p>
                        <input type="text" id="edit_value" placeholder=" サロン名" style="font-size: 16px;">
                        <div class="space_32"></div>   
                        <input type="submit" value="登録" id="post_button"> 
                        </form>`;
            modal.appendChild(child);
            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();
              const edit_value = document.getElementById('edit_value');
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: edit_value.value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;
          case "edit_microchip":
            edit_name = "マイクロチップ番号"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                          <p>マイクロチップ番号 (15桁の数字)</p>
                        <input type="number" id="edit_value" placeholder=" 392141111111111"
                            style="font-size: 16px;">
                        <div class="space_32"></div>   
                        <input type="submit" value="登録" id="post_button"> 
                        </form>`;
            modal.appendChild(child);
            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();
              const edit_value = document.getElementById('edit_value');
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: edit_value.value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;
          case "edit_Q1":
            edit_name = "犬の登録をし鑑札を受け取っていますか"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                          <p>犬の登録をし、鑑札を受け取って</br>いますか？<span class="sub">必須</span><br>
                            <label><input type="radio" name="登録" value="はい" required> はい</label>
                            <label><input type="radio" name="登録" value="いいえ"> いいえ</label>
                            <label><input type="radio" name="登録" value="分からない"> 分からない</label>
                        </p>
                        <div class="space_32"></div>   
                        <input type="submit" value="登録" id="post_button"> 
                        </form>`;
            modal.appendChild(child);
            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();

              const edit_value = myform.登録.value;
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: edit_value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;
          case "edit_Q2":
            edit_name = "狂犬病予防注射を受け注射済み票を受け取っていますか"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                          <p>狂犬病予防注射を受け、注射済み票を</br>受け取っていますか？<span class="sub">必須</span><br>
                            <label><input type="radio" name="注射" value="はい" required> はい</label>
                            <label><input type="radio" name="注射" value="いいえ"> いいえ</label>
                            <label><input type="radio" name="注射" value="分からない"> 分からない</label>
                        </p>
                        <div class="space_32"></div>   
                        <input type="submit" value="登録" id="post_button"> 
                        </form>`;
            modal.appendChild(child);
            myform = document.getElementById('myform');
            myform.addEventListener('submit', async (e) => {
              e.preventDefault();

              const edit_value = myform.注射.value;
              const washingtonRef = doc(db, "users", user_id, "pets", petID);
              await updateDoc(washingtonRef, {
                [edit_name]: edit_value
              });
              modal.classList.remove('active');
              overlay.classList.remove('active');
              child.remove();
            });
            break;
          case "edit_img01":
            edit_name = "写真"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                          <p>写真1:ペット写真<span class="sub">必須</span></p>
                        <input type="file" accept='.jpeg, .png, .jpg' id="pet_img" required>
                        <p id="img01_uploading"></p>
                        <div class="space_32"></div>   
                        </form>`;
            modal.appendChild(child);
            const img01_uploading = document.getElementById('img01_uploading');
            const pet_img = document.getElementById("pet_img");
            pet_img.addEventListener('change', (e) => {
              console.log(e.target.files);

              pet_img_file = e.target.files[0];
              // pet_img
              const storageRef01 = ref(storage, "pets/" + petID + "/" + "pet_img");
              const uploadTask01 = uploadBytesResumable(storageRef01, pet_img_file);
              uploadTask01.on('state_changed',
                (snapshot) => {
                  const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                  console.log('Upload is ' + progress + '% done', "01の画像");
                  img01_uploading.textContent = `アップロード中 ${progress}%`;
                  switch (snapshot.state) {
                    case 'paused':
                      console.log('Upload is paused', "01の画像");
                      break;
                    case 'running':
                      console.log('Upload is running', "01の画像");
                      break;
                  }
                },
                (error) => {
                  // Handle unsuccessful uploads
                  console.log("Handle unsuccessful uploads");
                },
                async () => {
                  await getDownloadURL(uploadTask01.snapshot.ref).then((downloadURL) => {
                    console.log('File available at', downloadURL);
                    pet_img_url = downloadURL;
                    img01_uploading.textContent = "";

                  });
                  const washingtonRef = doc(db, "users", user_id, "pets", petID);
                  updateDoc(washingtonRef, {
                    [edit_name]: pet_img_url
                  });
                  modal.classList.remove('active');
                  overlay.classList.remove('active');
                  child.remove();
                }
              );
            });

            break;
          case "edit_img02":
            edit_name = "狂犬病予防注射済み票"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                          <p>写真2:狂犬病予防注射済み票</p>
                        <input type="file" accept='.jpeg, .png, .jpg' id="狂犬病予防注射済み票">
                        <p id="img02_uploading"></p>
                        <div class="space_32"></div>   
                        </form>`;
            modal.appendChild(child);
            const img02_uploading = document.getElementById('img02_uploading');
            const 狂犬病予防注射済み票 = document.getElementById("狂犬病予防注射済み票");
            狂犬病予防注射済み票.addEventListener('change', (e) => {
              const change_info01 = confirm("この写真を使用しますか？");
              if (change_info01) {
                console.log(e.target.files);
  
                pet_img_file = e.target.files[0];
                // pet_img
                const storageRef02 = ref(storage, "pets/" + petID + "/" + "狂犬病予防注射済み票");
                const uploadTask02 = uploadBytesResumable(storageRef02, pet_img_file);
                uploadTask02.on('state_changed',
                  (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    console.log('Upload is ' + progress + '% done', "02の画像");
                    img02_uploading.textContent = `アップロード中 ${progress}%`;
                    switch (snapshot.state) {
                      case 'paused':
                        console.log('Upload is paused', "01の画像");
                        break;
                      case 'running':
                        console.log('Upload is running', "01の画像");
                        break;
                    }
                  },
                  (error) => {
                    // Handle unsuccessful uploads
                    console.log("Handle unsuccessful uploads");
                  },
                  async () => {
                    await getDownloadURL(uploadTask02.snapshot.ref).then((downloadURL) => {
                      console.log('File available at', downloadURL);
                      pet_img_url = downloadURL;
                      img02_uploading.textContent = "";
  
                    });
                    const washingtonRef = doc(db, "users", user_id, "pets", petID);
                    updateDoc(washingtonRef, {
                      [edit_name]: pet_img_url
                    });
                    modal.classList.remove('active');
                    overlay.classList.remove('active');
                    child.remove();
                  }
                );

              }
            });

            break;
          case "edit_img03":
            edit_name = "混合ワクチン接種証明書"
            child = document.createElement('div');
            child.innerHTML = `             
                        <form id="myform" class="m_auto">
                          <p>写真3:混合ワクチン接種証明書</p>
                        <input type="file" accept='.jpeg, .png, .jpg' id="混合ワクチン接種証明書">
                        <p id="img03_uploading"></p>
                        <div class="space_32"></div>   
                        </form>`;
            modal.appendChild(child);
            const img03_uploading = document.getElementById('img03_uploading');
            const 混合ワクチン接種証明書 = document.getElementById("混合ワクチン接種証明書");
            混合ワクチン接種証明書.addEventListener('change', (e) => {
              const change_info02 = confirm("この写真を使用しますか？");
              if (change_info02) {
                console.log(e.target.files);
  
                pet_img_file = e.target.files[0];
                // pet_img
                const storageRef03 = ref(storage, "pets/" + petID + "/" + "狂犬病予防注射済み票");
                const uploadTask03 = uploadBytesResumable(storageRef03, pet_img_file);
                uploadTask03.on('state_changed',
                  (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    console.log('Upload is ' + progress + '% done', "02の画像");
                    img03_uploading.textContent = `アップロード中 ${progress}%`;
                    switch (snapshot.state) {
                      case 'paused':
                        console.log('Upload is paused', "03の画像");
                        break;
                      case 'running':
                        console.log('Upload is running', "03の画像");
                        break;
                    }
                  },
                  (error) => {
                    // Handle unsuccessful uploads
                    console.log("Handle unsuccessful uploads");
                  },
                  async () => {
                    await getDownloadURL(uploadTask03.snapshot.ref).then((downloadURL) => {
                      console.log('File available at', downloadURL);
                      pet_img_url = downloadURL;
                      img03_uploading.textContent = "";
  
                    });
                    const washingtonRef = doc(db, "users", user_id, "pets", petID);
                    updateDoc(washingtonRef, {
                      [edit_name]: pet_img_url
                    });
                    modal.classList.remove('active');
                    overlay.classList.remove('active');
                    child.remove();
                  }
                );

              }
            });

            break;

          default:
            console.log("defailt");
        }
        modal.classList.add('active');
        overlay.classList.add('active');

      }, false);
    }


    // モダルの閉じるボタンをクリックしたら、モダルとオーバーレイのactiveクラスを外す
    closeBtn.addEventListener('click', function () {
      modal.classList.remove('active');
      overlay.classList.remove('active');
      child.remove();
    });

    // オーバーレイをクリックしたら、モダルとオーバーレイのactiveクラスを外す
    overlay.addEventListener('click', function () {
      modal.classList.remove('active');
      overlay.classList.remove('active');
      child.remove();
    });

  </script>


</body>

</html>